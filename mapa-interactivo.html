<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kaptia - Mapa Interactivo</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://scontent.fcvj5-1.fna.fbcdn.net/v/t39.30808-6/500737320_684205464497485_8214817728757942933_n.jpg"/>
  <!-- Fuente Google: Poppins -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet"/>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <!-- Estilos principales -->
  <link rel="stylesheet" href="styles.css"/>
  <style>
    /* Estilos para la barra lateral (sidebar) */
    .sidebar {
      width: 250px;
      background-color: #1d5c59;
      color: #ecf0f1;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: fixed;
      top: 0;
      left: 0;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    }

    /* Ajuste del contenedor principal */
    .main-content {
      margin-left: 250px;
      padding: 20px;
      min-height: 100vh;
      background-color: #f5f5f5;
    }

    /* Estilos para la sección del mapa */
    .map-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .filter-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-container select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      min-width: 200px;
      font-size: 14px;
    }

    .map-container {
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    /* Estilos para los marcadores y popups */
    .leaflet-popup-content {
      padding: 15px;
    }

    .leaflet-popup-content button {
      background: #1d5c59;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }

    .leaflet-popup-content button:hover {
      background: #164542;
    }

    /* Logo y menú */
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 30px;
    }

    .logo img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .logo h2 {
      color: white;
      margin: 0;
      font-size: 1.5rem;
    }

    .menu ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .menu ul li {
      margin: 10px 0;
    }

    .menu ul li a {
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      text-decoration: none;
      padding: 10px;
      border-radius: 4px;
      transition: background 0.3s;
    }

    .menu ul li a:hover,
    .menu ul li.active a {
      background: rgba(255, 255, 255, 0.1);
    }

    .menu ul li i {
      width: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <img src="https://scontent.fcvj5-1.fna.fbcdn.net/v/t39.30808-6/500737320_684205464497485_8214817728757942933_n.jpg" 
           alt="Logo" 
           class="logo-img">
      <h2>Kaptia</h2>
    </div>
    <nav class="menu">
      <ul>
        <li>
          <a href="./home.html">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
          </a>
        </li>
        <li class="active">
          <a href="./mapa-interactivo.html">
            <i class="fas fa-map-marked-alt"></i>
            <span>Mapa Interactivo</span>
          </a>
        </li>
        <li>
          <a href="./clientes.html">
            <i class="fas fa-users"></i>
            <span>Clientes</span>
          </a>
        </li>
        <li>
          <a href="./reportes.html">
            <i class="fas fa-chart-bar"></i>
            <span>Reportes</span>
          </a>
        </li>
      </ul>
    </nav>
    <div class="sidebar-footer">
      <a href="index.html">
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar Sesión</span>
      </a>
    </div>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-content">
    <header class="topbar">
      <h1>Características de Clientes Potenciales</h1>
    </header>

    <!-- Contenedor del Mapa y Filtros -->
    <div class="map-section">
      <!-- Filtros -->
      <div class="filter-container">
        <select id="filterEstado">
          <option value="">Estado: Todos</option>
        </select>
        <select id="filterPrioridad">
          <option value="">Prioridad: Todas</option>
          <option value="Alta">Alta</option>
          <option value="Media">Media</option>
          <option value="Baja">Baja</option>
        </select>
        <select id="filterCanal">
          <option value="">Canal de Compra: Todo</option>
          <option value="Directo">Directo</option>
          <option value="Distribuidor">Distribuidor</option>
          <option value="Online">Online</option>
        </select>
      </div>

      <!-- Contenedor del Mapa -->
      <div class="map-container">
        <div id="map"></div>
      </div>
    </div>
  </main>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar el mapa centrado en México
      const map = L.map('map').setView([23.634501, -102.552784], 5);
      
      // Añadir capa de OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Datos de ejemplo para los marcadores
      const locations = [
        {
          id: 1,
          lat: 19.4326,
          lng: -99.1332,
          name: "Invernaderos Bonanza",
          type: "Distribuidor",
          priority: "Alta",
          state: "CDMX",
          details: {
            address: "Av. Reforma 123",
            contact: "Juan Pérez",
            phone: "555-0123",
            email: "contacto@invernaderos.com"
          }
        },
        {
          id: 2,
          lat: 20.6597,
          lng: -103.3496,
          name: "Agrícola del Valle",
          type: "Directo",
          priority: "Media",
          state: "Jalisco",
          details: {
            address: "Calle Industria 456",
            contact: "María González",
            phone: "333-4567",
            email: "info@agricolavalle.com"
          }
        },
        {
          id: 3,
          lat: 25.6866,
          lng: -100.3161,
          name: "Distribuidora Norte",
          type: "Distribuidor",
          priority: "Alta",
          state: "Nuevo León",
          details: {
            address: "Av. Universidad 789",
            contact: "Roberto Sánchez",
            phone: "818-8901",
            email: "ventas@distnorte.com"
          }
        },
        {
          id: 4,
          lat: 22.1565,
          lng: -100.9855,
          name: "Agro San Luis",
          type: "Online",
          priority: "Baja",
          state: "San Luis Potosí",
          details: {
            address: "Blvd. Central 234",
            contact: "Ana Martínez",
            phone: "444-5678",
            email: "contacto@agroslp.com"
          }
        }
      ];

      let markers = [];

      // Función para crear marcadores
      function addMarkers(data) {
        // Limpiar marcadores existentes
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        data.forEach(location => {
          const marker = L.circleMarker([location.lat, location.lng], {
            radius: 8,
            fillColor: getPriorityColor(location.priority),
            color: '#fff',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.8
          });

          const popupContent = `
            <div class="popup-content">
              <h3>${location.name}</h3>
              <p><strong>Estado:</strong> ${location.state}</p>
              <p><strong>Tipo:</strong> ${location.type}</p>
              <p><strong>Prioridad:</strong> ${location.priority}</p>
              <p><strong>Contacto:</strong> ${location.details.contact}</p>
              <p><strong>Teléfono:</strong> ${location.details.phone}</p>
              <p><strong>Email:</strong> ${location.details.email}</p>
              <button onclick="openProposalModal(${location.id})">Ver Detalles</button>
            </div>
          `;

          marker.bindPopup(popupContent);
          marker.addTo(map);
          markers.push(marker);
        });
      }

      // Función para obtener el color según la prioridad
      function getPriorityColor(priority) {
        switch(priority) {
          case 'Alta': return '#4CAF50';
          case 'Media': return '#FFC107';
          case 'Baja': return '#F44336';
          default: return '#9E9E9E';
        }
      }

      // Función para aplicar filtros
      function applyFilters() {
        const estado = document.getElementById('filterEstado').value;
        const prioridad = document.getElementById('filterPrioridad').value;
        const canal = document.getElementById('filterCanal').value;

        const filteredLocations = locations.filter(location => {
          const matchEstado = !estado || location.state === estado;
          const matchPrioridad = !prioridad || location.priority === prioridad;
          const matchCanal = !canal || location.type === canal;
          return matchEstado && matchPrioridad && matchCanal;
        });

        addMarkers(filteredLocations);
      }

      // Poblar el select de Estados
      const estados = [...new Set(locations.map(l => l.state))].sort();
      const filterEstado = document.getElementById('filterEstado');
      estados.forEach(estado => {
        const option = document.createElement('option');
        option.value = estado;
        option.textContent = estado;
        filterEstado.appendChild(option);
      });

      // Eventos para los filtros
      document.getElementById('filterEstado').addEventListener('change', applyFilters);
      document.getElementById('filterPrioridad').addEventListener('change', applyFilters);
      document.getElementById('filterCanal').addEventListener('change', applyFilters);

      // Inicializar marcadores
      addMarkers(locations);
    });

    // Función para abrir el modal de propuesta
    function openProposalModal(id) {
      alert(`Ver detalles del cliente ${id}`);
    }
  </script>
</body>
</html> 