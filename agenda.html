<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kaptia - Agenda</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://scontent.fcvj5-1.fna.fbcdn.net/v/t39.30808-6/500737320_684205464497485_8214817728757942933_n.jpg?stp=cp6_dst-jpg_tt6&_nc_cat=103&ccb=1-7&_nc_sid=833d8c&_nc_ohc=tJh3AuSi5rkQ7kNvwHSd86T&_nc_oc=AdnIQRGQh5aisLMkCwlI77dOf8e3uxbuGQQ71ixGMWU367xEGMcVrbCZw9CIAGAVPIX5y4cSNooJRRmED_-Pk2Oj&_nc_zt=23&_nc_ht=scontent.fcvj5-1.fna&_nc_gid=h4B5xRQOO6bq6jsCwHbLoA&oh=00_AfJUFyGLAQ4Sy8kMl-AmfD68XXPXLA49Yb_gGTXhkBILfg&oe=6837FAED"/>
  <!-- Fuente Google: Poppins -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,600&display=swap" rel="stylesheet"/>
  <!-- Hoja de estilos principal -->
  <link rel="stylesheet" href="styles.css"/>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <style>
    /* Estilos para el calendario */
    .schedule-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .schedule-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .schedule-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .schedule-filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      position: relative;
    }

    .filter-select {
      padding: 10px 35px 10px 15px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #fff;
      font-size: 0.95rem;
      color: #333;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      transition: all 0.3s ease;
      min-width: 200px;
    }

    .filter-select:hover {
      border-color: var(--color-primario);
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--color-primario);
      box-shadow: 0 0 0 3px rgba(29, 92, 89, 0.1);
    }

    .schedule-info button {
      background-color: var(--color-primario);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .schedule-info button:hover {
      background-color: var(--color-primario-hover);
      transform: translateY(-1px);
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(6, 1fr); /* Siempre 6 filas */
      gap: 12px;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      aspect-ratio: 7/6; /* Mantener proporción */
      min-height: 800px; /* Altura mínima fija */
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 12px;
      margin-bottom: 12px;
      font-weight: 600;
      color: #666;
      height: 40px;
    }

    .calendar-header div {
      text-align: center;
      padding: 10px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .calendar-day {
      padding: 10px;
      height: 100%; /* Llenar todo el espacio disponible */
      min-height: 120px;
      border: 1px solid #eee;
      border-radius: 8px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      background: #fff;
      display: flex;
      flex-direction: column;
    }

    .calendar-day.other-month {
      background-color: #f8f9fa;
      opacity: 0.7;
    }

    .calendar-day:hover {
      border-color: var(--color-primario);
      box-shadow: 0 2px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .calendar-day-number {
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 10px;
      color: #333;
    }

    .calendar-day.other-month .calendar-day-number {
      color: #999;
    }

    .calendar-day.today {
      border: 2px solid var(--color-primario);
      background-color: #f0f7f7;
    }

    .calendar-events {
      margin-top: 25px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      flex: 1;
      overflow-y: auto;
      padding-right: 2px;
    }

    .calendar-events::-webkit-scrollbar {
      width: 4px;
    }

    .calendar-events::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 2px;
    }

    .calendar-events::-webkit-scrollbar-thumb {
      background: var(--color-primario);
      border-radius: 2px;
    }

    .calendar-event {
      background-color: #fff;
      border-radius: 4px;
      padding: 6px 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      border: 1px solid #eee;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .calendar-event:hover {
      transform: translateX(2px);
      background-color: #f8f8f8;
      border-color: var(--color-primario);
    }

    .event-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 0.75rem;
      font-weight: 500;
      margin-bottom: 3px;
    }

    .event-time {
      font-size: 0.75rem;
      color: #666;
      margin-top: 2px;
    }

    /* Mejoras en la navegación del calendario */
    .calendar-navigation {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .calendar-navigation h2 {
      margin: 0;
      font-size: 1.2rem;
      min-width: 200px;
      text-align: center;
    }

    .calendar-navigation button {
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: var(--color-primario);
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .calendar-navigation button:hover {
      background-color: rgba(29, 92, 89, 0.1);
    }

    /* Estilos para múltiples eventos */
    .calendar-day.has-events::after {
      content: '';
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: var(--color-primario);
    }

    .calendar-day.has-many-events::after {
      width: 12px;
      height: 6px;
      border-radius: 3px;
    }

    /* Botón flotante para nuevo evento */
    .floating-button {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: var(--color-primario);
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .floating-button:hover {
      background-color: var(--color-primario-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }

    /* Estilos para modales */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1001;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fff;
      padding: 25px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      position: relative;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .modal h2 {
      margin-top: 0;
      color: #333;
      font-size: 1.5rem;
      margin-bottom: 20px;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      color: #666;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close-modal:hover {
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .form-group label.required .required-icon {
      color: var(--color-primario);
      margin-right: 8px;
      font-size: 0.9em;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9rem;
      color: #333;
      transition: all 0.3s ease;
      background-color: #fff;
    }

    /* Estilos específicos para inputs de fecha y hora */
    .form-group input[type="date"],
    .form-group input[type="time"] {
      position: relative;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M8 1v2M16 1v2M3 5h18M3 5v14a2 2 0 002 2h14a2 2 0 002-2V5'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      padding-right: 40px;
    }

    .form-group input[type="time"] {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M12 6v6l4 2'/%3E%3C/svg%3E");
    }

    /* Estilos para el calendario nativo */
    ::-webkit-calendar-picker-indicator {
      opacity: 0;
      cursor: pointer;
      position: absolute;
      right: 8px;
      width: 24px;
      height: 24px;
    }

    ::-webkit-datetime-edit {
      padding: 0;
    }

    ::-webkit-datetime-edit-fields-wrapper {
      padding: 0;
    }

    ::-webkit-datetime-edit-text {
      padding: 0 2px;
    }

    ::-webkit-datetime-edit-month-field,
    ::-webkit-datetime-edit-day-field,
    ::-webkit-datetime-edit-year-field,
    ::-webkit-datetime-edit-hour-field,
    ::-webkit-datetime-edit-minute-field,
    ::-webkit-datetime-edit-ampm-field {
      padding: 0 2px;
    }

    /* Estilos para el select personalizado de hora */
    .time-select-wrapper {
      position: relative;
    }

    .time-select {
      appearance: none;
      -webkit-appearance: none;
      padding-right: 40px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
    }

    /* Estados de hover y focus mejorados */
    .form-group input:hover,
    .form-group select:hover,
    .form-group textarea:hover {
      border-color: var(--color-primario);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-primario);
      box-shadow: 0 0 0 3px rgba(29, 92, 89, 0.1);
    }

    /* Ajustes responsivos */
    @media (max-width: 768px) {
      .calendar {
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }

      .calendar div {
        padding: 5px;
        min-height: 80px;
        font-size: 0.8rem;
      }

      .event-tag {
        padding: 2px 6px;
        font-size: 0.7rem;
      }

      .schedule-filters {
        flex-wrap: wrap;
      }

      .filter-select {
        width: 100%;
      }

      .floating-button {
        width: 50px;
        height: 50px;
        font-size: 20px;
        bottom: 20px;
        right: 20px;
      }

      .form-group input[type="date"],
      .form-group input[type="time"],
      .time-select {
        font-size: 16px; /* Previene zoom en iOS */
      }
    }

    /* Slide-over panel para nuevo evento */
    .slide-over {
      position: fixed;
      top: 0;
      right: -500px;
      width: 100%;
      max-width: 500px;
      height: 100vh;
      background-color: #fff;
      box-shadow: -5px 0 25px rgba(0,0,0,0.1);
      transition: right 0.3s ease-in-out;
      z-index: 1001;
      display: flex;
      flex-direction: column;
    }

    .slide-over.active {
      right: 0;
    }

    .slide-over-header {
      padding: 20px 25px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .slide-over-header h2 {
      margin: 0;
      font-size: 1.5rem;
      color: #333;
    }

    .slide-over-content {
      padding: 25px;
      flex: 1;
      overflow-y: auto;
    }

    .slide-over-footer {
      padding: 20px 25px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      background: #fff;
    }

    /* Mejoras en el formulario */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #555;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.95rem;
      color: #333;
      transition: all 0.3s ease;
    }

    .form-group input:hover,
    .form-group select:hover,
    .form-group textarea:hover {
      border-color: var(--color-primario);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-primario);
      box-shadow: 0 0 0 3px rgba(29, 92, 89, 0.1);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* Botones mejorados */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn i {
      font-size: 1.1rem;
    }

    .btn-primary {
      background-color: var(--color-primario);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--color-primario-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background-color: #f5f5f5;
      color: #333;
    }

    .btn-secondary:hover {
      background-color: #e0e0e0;
      transform: translateY(-1px);
    }

    /* Overlay para el fondo */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    @media (max-width: 768px) {
      .slide-over {
        max-width: 100%;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }
    }

    /* Estilos para los tipos de eventos */
    .event-tag.visita {
      background-color: #e3f2fd;
      color: #1565c0;
    }

    .event-tag.llamada {
      background-color: #f3e5f5;
      color: #7b1fa2;
    }

    .event-tag.reunion {
      background-color: #e8f5e9;
      color: #2e7d32;
    }

    .event-tag.entrega {
      background-color: #fff3e0;
      color: #ef6c00;
    }

    /* Notificaciones */
    .notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 1002;
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      min-width: 300px;
      justify-content: center;
    }

    .notification.error {
      background-color: #fee2e2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }

    .notification.success {
      background-color: #dcfce7;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }

    .notification i {
      font-size: 1.2em;
    }

    .notification.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body class="has-sidebar">
  <!-- SIDEBAR -->
  <aside class="sidebar" style="display: flex; flex-direction: column;">
    <div>
      <div class="sidebar-profile">
        <img src="https://scontent.fcvj5-1.fna.fbcdn.net/v/t39.30808-6/493125038_685139734404058_5788015028353864134_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=833d8c&_nc_ohc=2HJpAiRI9XsQ7kNvwFeltDD&_nc_oc=AdmEetw5xa9ARhaYIlBZUGquqouFwc3V_4zBzTMq45x41M2qfDPeLrGRzLClXo8toKmsg6BOgWmf1_7CdVN8bUKR&_nc_zt=23&_nc_ht=scontent.fcvj5-1.fna&_nc_gid=ylZKEG8nDw8Uwdzvt1wHmA&oh=00_AfIMeLHR5kfFxGz5n_TjiB-f8FTYZXE5j9UQCwzy0nPE0w&oe=6839B38E" alt="KaptiaBot"/>
        <div class="profile-info">
          <h3>KaptiaBot</h3>
        </div>
      </div>
      <nav class="menu">
        <ul>
          <li><a href="home.html"><i class="fas fa-home"></i> Página de inicio</a></li>
          <li><a href="resumen.html"><i class="fas fa-map"></i> Mapa interactivo</a></li>
          <li><a href="chatbot.html"><i class="fas fa-users"></i> Mis clientes</a></li>
          <li><a href="tableros.html"><i class="fas fa-chart-line"></i> Métricas clave</a></li>
          <li class="active"><a href="agenda.html"><i class="fas fa-calendar"></i> Agenda</a></li>
          <li><a href="mensajes.html"><i class="fas fa-envelope"></i> Mensajes</a></li>
          <li><a href="contacto-asesor.html"><i class="fas fa-headset"></i> Contacta un asesor</a></li>
        </ul>
      </nav>
    </div>
    <div class="sidebar-footer">
      <a href="#"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
    </div>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="main-content">
    <header class="topbar">
      <h1>Agenda</h1>
      <div class="topbar-actions">
        <div class="search-user-section">
          <div class="search-bar">
            <input type="text" placeholder="Buscar..." />
            <i class="fas fa-search"></i>
          </div>
          <div class="user-profile">
            <img src="https://media.licdn.com/dms/image/v2/D5603AQEw-UoZ06Kb-A/profile-displayphoto-shrink_200_200/B56ZcELhdZHwAc-/0/1748121819494?e=1753315200&v=beta&t=umlB7AE5ew2DhHiSiN3-sUj3KmX2enK5mF7vCQyGtME" alt="Usuario" class="avatar" />
            <div class="dropdown-menu">
              <a href="#"><i class="fas fa-user"></i> Mi Perfil</a>
              <a href="#"><i class="fas fa-cog"></i> Configuración</a>
              <a href="#"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a>
            </div>
          </div>
          <div class="icons">
            <i class="fas fa-bell"></i>
          </div>
        </div>
      </div>
    </header>

    <div class="content-wrapper">
      <!-- Calendario de Citas -->
      <div class="schedule-section">
        <div class="calendar-navigation">
          <button id="prevYearBtn"><i class="fas fa-angle-double-left"></i></button>
          <button id="prevMonthBtn"><i class="fas fa-angle-left"></i></button>
          <h2>Mayo 2025</h2>
          <button id="nextMonthBtn"><i class="fas fa-angle-right"></i></button>
          <button id="nextYearBtn"><i class="fas fa-angle-double-right"></i></button>
          <button id="todayBtn">Hoy</button>
        </div>
        <div class="schedule-filters">
          <select class="filter-select" id="eventTypeFilter">
            <option value="todos">Todos los eventos</option>
            <option value="visita">Visitas</option>
            <option value="llamada">Llamadas</option>
            <option value="reunion">Reuniones</option>
            <option value="entrega">Entregas</option>
          </select>
        </div>
        <div class="calendar-header">
          <div>Dom</div>
          <div>Lun</div>
          <div>Mar</div>
          <div>Mié</div>
          <div>Jue</div>
          <div>Vie</div>
          <div>Sáb</div>
        </div>
        <div class="calendar" id="calendarGrid"></div>
      </div>
    </div>

    <!-- Botón flotante para nuevo evento -->
    <div class="floating-button" id="newEventBtn">
      <i class="fas fa-plus"></i>
    </div>

    <!-- Modal para detalles del evento -->
    <div class="modal" id="eventDetailsModal">
      <div class="modal-content">
        <span class="close-modal" id="closeEventDetails">&times;</span>
        <h2>Detalles del Evento</h2>
        <div class="form-group">
          <label>Tipo de Evento</label>
          <p id="eventType"></p>
        </div>
        <div class="form-group">
          <label>Cliente</label>
          <p id="eventClient"></p>
        </div>
        <div class="form-group">
          <label>Fecha y Hora</label>
          <p id="eventDateTime"></p>
        </div>
        <div class="form-group">
          <label>Ubicación</label>
          <p id="eventLocation"></p>
        </div>
        <div class="form-group">
          <label>Notas</label>
          <p id="eventNotes"></p>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="closeEventDetails()">Cerrar</button>
          <button class="btn btn-primary" onclick="editEvent()">Editar</button>
        </div>
      </div>
    </div>

    <!-- Slide-over panel para nuevo evento -->
    <div class="overlay" id="newEventOverlay"></div>
    <div class="slide-over" id="newEventSlideOver">
      <div class="slide-over-header">
        <h2>Nuevo Evento</h2>
        <button class="btn btn-secondary" onclick="closeNewEvent()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="slide-over-content">
        <form id="newEventForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="eventType" class="required">
                <i class="fas fa-tag required-icon"></i>
                Tipo de Evento
              </label>
              <select id="eventType" required>
                <option value="">Seleccionar</option>
                <option value="visita">Visita</option>
                <option value="llamada">Llamada</option>
                <option value="reunion">Reunión</option>
                <option value="entrega">Entrega</option>
              </select>
            </div>
            <div class="form-group">
              <label for="eventClient" class="required">
                <i class="fas fa-user required-icon"></i>
                Cliente
              </label>
              <input type="text" id="eventClient" required placeholder="Nombre del cliente">
            </div>
            <div class="form-group">
              <label for="eventDate" class="required">
                <i class="fas fa-calendar required-icon"></i>
                Fecha
              </label>
              <input type="date" id="eventDate" required min="${new Date().toISOString().split('T')[0]}">
            </div>
            <div class="form-group">
              <label for="eventTime" class="required">
                <i class="fas fa-clock required-icon"></i>
                Hora
              </label>
              <div class="time-select-wrapper">
                <select id="eventTime" class="time-select" required>
                  <option value="">Seleccionar</option>
                </select>
              </div>
            </div>
            <div class="form-group full-width">
              <label for="eventLocation">Ubicación</label>
              <input type="text" id="eventLocation" placeholder="Dirección o enlace de reunión virtual">
            </div>
            <div class="form-group full-width">
              <label for="eventNotes">Notas</label>
              <textarea id="eventNotes" placeholder="Detalles adicionales del evento"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="slide-over-footer">
        <button type="button" class="btn btn-secondary" id="cancelEventBtn">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button type="button" class="btn btn-primary" id="saveEventBtn">
          <i class="fas fa-check"></i> Finalizado
        </button>
      </div>
      <script>
        // Event listeners para los botones
        document.getElementById('cancelEventBtn').addEventListener('click', function() {
          closeNewEvent();
        });

        document.getElementById('saveEventBtn').addEventListener('click', function() {
          saveNewEvent();
        });

        // Función para cerrar el panel
        function closeNewEvent() {
          const slideOver = document.getElementById('newEventSlideOver');
          const overlay = document.getElementById('newEventOverlay');
          
          slideOver.classList.remove('active');
          overlay.classList.remove('active');
          
          // Limpiar el formulario
          document.getElementById('newEventForm').reset();
        }
      </script>
    </div>

  </main>

  <!-- SCRIPTS -->
  <script src="scripts.js"></script>
  <script src="topbar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Variables globales
      const calendarGrid = document.getElementById('calendarGrid');
      const monthTitle = document.querySelector('.calendar-navigation h2');
      const prevYearBtn = document.getElementById('prevYearBtn');
      const nextYearBtn = document.getElementById('nextYearBtn');
      const prevMonthBtn = document.getElementById('prevMonthBtn');
      const nextMonthBtn = document.getElementById('nextMonthBtn');
      const todayBtn = document.getElementById('todayBtn');
      const newEventBtn = document.getElementById('newEventBtn');
      const newEventSlideOver = document.getElementById('newEventSlideOver');
      const newEventOverlay = document.getElementById('newEventOverlay');
      const eventTypeFilter = document.getElementById('eventTypeFilter');
      const newEventForm = document.getElementById('newEventForm');

      // Estado del calendario
      let currentDate = new Date();
      let selectedDate = new Date(2025, 4, 1); // Iniciar en Mayo 2025
      let events = JSON.parse(localStorage.getItem('calendarEvents')) || {};

      // Datos de ejemplo
      const sampleEvents = {
        '2025-05-04': [{
          id: 1,
          type: 'visita',
          client: 'Invernaderos Bonanza',
          time: '14:00',
          location: 'Carretera Principal km 5',
          notes: 'Revisión de instalaciones'
        }],
        '2025-05-10': [{
          id: 2,
          type: 'llamada',
          client: 'Finca La Paloma',
          time: '11:00',
          location: 'Llamada virtual',
          notes: 'Seguimiento de pedido'
        }],
        '2025-05-15': [{
          id: 3,
          type: 'reunion',
          client: 'Agroindustrial El Sol',
          time: '15:00',
          location: 'Oficinas centrales',
          notes: 'Presentación de nuevos productos'
        }],
        '2025-05-19': [{
          id: 4,
          type: 'visita',
          client: 'Frutos de la Sierra',
          time: '10:00',
          location: 'Valle Norte',
          notes: 'Inspección de cultivos'
        }],
        '2025-05-24': [{
          id: 5,
          type: 'entrega',
          client: 'Hortalizas del Campo',
          time: '13:00',
          location: 'Centro de distribución',
          notes: 'Entrega de pedido mensual'
        }],
        '2025-05-29': [{
          id: 6,
          type: 'llamada',
          client: 'Frutos de la Sierra',
          time: '16:00',
          location: 'Llamada virtual',
          notes: 'Seguimiento de visita'
        }]
      };

      // Si no hay eventos guardados, usar los de ejemplo
      if (Object.keys(events).length === 0) {
        events = sampleEvents;
        localStorage.setItem('calendarEvents', JSON.stringify(events));
      }

      // Funciones para el manejo del slide-over
      function openNewEvent() {
        newEventSlideOver.classList.add('active');
        newEventOverlay.classList.add('active');
      }

      function closeNewEvent() {
        newEventSlideOver.classList.remove('active');
        newEventOverlay.classList.remove('active');
        newEventForm.reset();
      }

      // Generar opciones de hora
      function generateTimeOptions() {
        const timeSelect = document.getElementById('eventTime');
        const startHour = 7;
        const endHour = 20;

        timeSelect.innerHTML = '<option value="">Seleccionar</option>';

        for (let hour = startHour; hour <= endHour; hour++) {
          for (let minutes = 0; minutes < 60; minutes += 15) {
            const hourStr = hour.toString().padStart(2, '0');
            const minutesStr = minutes.toString().padStart(2, '0');
            const timeStr = `${hourStr}:${minutesStr}`;
            const option = document.createElement('option');
            option.value = timeStr;
            option.textContent = timeStr;
            timeSelect.appendChild(option);
          }
        }
        
        // Agregar event listener para validar la selección
        timeSelect.addEventListener('change', function() {
          console.log('Hora seleccionada:', this.value);
        });
      }

      // Filtrado de eventos
      eventTypeFilter.addEventListener('change', function() {
        const selectedType = this.value;
        const allEvents = document.querySelectorAll('.calendar-event');
        
        allEvents.forEach(event => {
          const eventType = event.querySelector('.event-tag').classList[1];
          if (selectedType === 'todos' || eventType === selectedType) {
            event.style.display = 'block';
          } else {
            event.style.display = 'none';
          }
        });
      });

      // Event listeners
      newEventBtn.addEventListener('click', openNewEvent);
      newEventOverlay.addEventListener('click', closeNewEvent);

      // Función para mostrar notificación
      function showNotification(message, type = 'error') {
        // Remover notificación anterior si existe
        const existingNotification = document.querySelector('.notification');
        if (existingNotification) {
          existingNotification.remove();
        }

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        
        // Agregar icono según el tipo
        const icon = document.createElement('i');
        icon.className = type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
        notification.insertBefore(icon, notification.firstChild);
        
        document.body.appendChild(notification);

        setTimeout(() => {
          notification.classList.add('show');
          setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 300);
          }, 3000);
        }, 100);
      }

      // Funciones del calendario
      function updateCalendar() {
        const year = selectedDate.getFullYear();
        const month = selectedDate.getMonth();
        
        // Actualizar título
        const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        monthTitle.textContent = `${months[month]} ${year}`;

        // Limpiar calendario
        calendarGrid.innerHTML = '';

        // Obtener primer día del mes
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        
        // Calcular el primer día de la primera semana del calendario
        let firstDayOfWeek = firstDay.getDay();
        if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Ajustar domingo a 7
        firstDayOfWeek--; // Ajustar a base 0
        
        // Calcular fecha del primer día a mostrar (último mes)
        const prevMonthDays = new Date(year, month, 0).getDate();
        const firstVisibleDate = prevMonthDays - firstDayOfWeek;
        
        // Generar array de 42 días (6 semanas)
        const totalDays = 42;
        let currentDate = new Date(year, month - 1, firstVisibleDate);
        
        // Crear la cuadrícula de 6 semanas
        for (let i = 0; i < totalDays; i++) {
          const isCurrentMonth = currentDate.getMonth() === month;
          createDayElement(new Date(currentDate), !isCurrentMonth);
          currentDate.setDate(currentDate.getDate() + 1);
        }

        // Asegurar que el grid tenga 6 filas
        calendarGrid.style.gridTemplateRows = 'repeat(6, 1fr)';
      }

      function createDayElement(date, isOtherMonth) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        if (isOtherMonth) dayElement.classList.add('other-month');
        
        // Verificar si es hoy
        if (isSameDate(date, new Date())) {
          dayElement.classList.add('today');
        }

        // Agregar número del día
        const dayNumber = document.createElement('span');
        dayNumber.className = 'calendar-day-number';
        dayNumber.textContent = date.getDate();
        dayElement.appendChild(dayNumber);

        // Contenedor para eventos
        const eventsContainer = document.createElement('div');
        eventsContainer.className = 'calendar-events';
        dayElement.appendChild(eventsContainer);

        // Agregar eventos del día
        const dateStr = formatDate(date);
        const dayEvents = events[dateStr] || [];
        
        if (dayEvents.length > 0) {
          dayElement.classList.add('has-events');
          if (dayEvents.length > 2) {
            dayElement.classList.add('has-many-events');
          }
          
          dayEvents.slice(0, 3).forEach(event => {
            const eventElement = createEventElement(event);
            eventsContainer.appendChild(eventElement);
          });

          if (dayEvents.length > 3) {
            const moreEvents = document.createElement('div');
            moreEvents.className = 'event-more';
            moreEvents.textContent = `+${dayEvents.length - 3} más`;
            eventsContainer.appendChild(moreEvents);
          }
        }

        calendarGrid.appendChild(dayElement);
      }

      function createEventElement(event) {
        const eventElement = document.createElement('div');
        eventElement.className = 'calendar-event';
        eventElement.innerHTML = `
          <span class="event-tag ${event.type}">${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</span>
          <div>${event.client}</div>
          <div class="event-time">${formatTime(event.time)}</div>
        `;
        
        eventElement.addEventListener('click', () => showEventDetails(event));
        return eventElement;
      }

      // Funciones auxiliares
      function formatDate(date) {
        return date.toISOString().split('T')[0];
      }

      function formatTime(time) {
        return time.substring(0, 5);
      }

      function isSameDate(date1, date2) {
        return date1.getDate() === date2.getDate() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getFullYear() === date2.getFullYear();
      }

      // Event Listeners para navegación
      prevYearBtn.addEventListener('click', () => {
        selectedDate.setFullYear(selectedDate.getFullYear() - 1);
        updateCalendar();
      });

      nextYearBtn.addEventListener('click', () => {
        selectedDate.setFullYear(selectedDate.getFullYear() + 1);
        updateCalendar();
      });

      prevMonthBtn.addEventListener('click', () => {
        selectedDate.setMonth(selectedDate.getMonth() - 1);
        updateCalendar();
      });

      nextMonthBtn.addEventListener('click', () => {
        selectedDate.setMonth(selectedDate.getMonth() + 1);
        updateCalendar();
      });

      todayBtn.addEventListener('click', () => {
        selectedDate = new Date();
        updateCalendar();
      });

      // Función mejorada para guardar nuevo evento
      window.saveNewEvent = function() {
        // Obtener elementos del formulario
        const typeElement = document.getElementById('eventType');
        const clientElement = document.getElementById('eventClient');
        const dateElement = document.getElementById('eventDate');
        const timeElement = document.getElementById('eventTime');
        const locationElement = document.getElementById('eventLocation');
        const notesElement = document.getElementById('eventNotes');

        // Obtener valores y hacer trim() para eliminar espacios en blanco
        const type = typeElement.value.trim();
        const client = clientElement.value.trim();
        const date = dateElement.value.trim();
        const time = timeElement.value.trim();
        const location = locationElement.value.trim();
        const notes = notesElement.value.trim();

        // Validar campos requeridos
        const requiredFields = [
          { name: 'Tipo de Evento', value: type, element: typeElement },
          { name: 'Cliente', value: client, element: clientElement },
          { name: 'Fecha', value: date, element: dateElement },
          { name: 'Hora', value: time, element: timeElement }
        ];

        // Verificar cada campo requerido
        for (const field of requiredFields) {
          if (!field.value) {
            field.element.focus();
            showNotification(`El campo ${field.name} es requerido`);
            return;
          }
        }

        try {
          // Crear el nuevo evento
          const newEvent = {
            id: Date.now(),
            type,
            client,
            time,
            location,
            notes
          };

          // Obtener eventos existentes o inicializar array
          if (!events[date]) {
            events[date] = [];
          }
          
          // Agregar nuevo evento
          events[date].push(newEvent);
          
          // Guardar en localStorage
          localStorage.setItem('calendarEvents', JSON.stringify(events));
          
          // Actualizar calendario
          updateCalendar();
          
          // Mostrar notificación de éxito
          showNotification('Evento guardado exitosamente', 'success');
          
          // Cerrar el panel
          closeNewEvent();
          
        } catch (error) {
          console.error('Error al guardar el evento:', error);
          showNotification('Error al guardar el evento', 'error');
        }

        try {
          // Validar fecha y hora
          const dateObj = new Date(`${date}T${time}`);
          if (isNaN(dateObj.getTime())) {
            throw new Error('Fecha u hora inválida');
          }

          // Crear nuevo evento
          const newEvent = {
            id: Date.now(),
            type,
            client,
            date,
            time,
            location,
            notes
          };

          // Guardar evento
          const dateStr = formatDate(dateObj);
          if (!events[dateStr]) {
            events[dateStr] = [];
          }
          events[dateStr].push(newEvent);

          // Guardar en localStorage
          localStorage.setItem('calendarEvents', JSON.stringify(events));

          // Actualizar calendario
          updateCalendar();

          // Cerrar formulario y mostrar confirmación
          closeNewEvent();
          showNotification('Evento guardado exitosamente');

          // Si el mes del evento no es el actual, preguntar si desea ir a ese mes
          const eventMonth = dateObj.getMonth();
          const eventYear = dateObj.getFullYear();
          if (eventMonth !== selectedDate.getMonth() || eventYear !== selectedDate.getFullYear()) {
            if (confirm('¿Deseas ir al mes del evento creado?')) {
              selectedDate = new Date(eventYear, eventMonth, 1);
              updateCalendar();
            }
          }
        } catch (error) {
          console.error('Error al guardar el evento:', error);
          alert('Error al guardar el evento. Por favor verifica los datos ingresados.');
        }
      };

      // Inicialización
      generateTimeOptions();
      updateCalendar();
    });
  </script>
</body>
</html> 